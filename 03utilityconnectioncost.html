<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Land Purchase Cost</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-light">

    <!-- Header -->
    <nav class="navbar lime-header bg-dark px-3">
        <div class="container-fluid text-white">
        <a href="00b.dashboard.html" class="btn btn-sm btn-outline-light me-2">← Back</a>
        <span class="navbar-brand mb-0 h6 text-white">Utility Connection Cost</span>
        </div>
    </nav>

    <!--- Picked Property Details --->
    <div class="mb-3 bg-light border rounded small p-2">
        <div><strong>Address:</strong> <span id="summaryAddress">Loading...</span></div>
        <div><strong>Parcel ID:</strong> <span id="summaryParcelID">Loading...</span></div>
        <div><strong>Coordinates:</strong> <span id="summaryCoords">Loading...</span></div>
    </div>

    <div class="container my-5">

      <!-- Water -->
      <div class="mb-4">
        <h6 class="fw-bold">Water Source</h6>
        <div class="row g-2 align-items-end">
          <div class="col-md-4">
            <label class="form-label">Type</label>
            <select id="waterSource" class="form-select" onchange="setUnitFromSelect('waterSource','waterUnitCost')">
              <option selected disabled>Choose Water Source</option>
              <option value="public" data-cost="9975">Public Water ($9,975)</option>
              <option value="well" data-cost="30850">Private Water Well ($30,850)</option>
              <option value="co-op" data-cost="4500">Water Co-op ($4,500)</option>
              <option value="haul" data-cost="0">Water Hauling (Tank Storage) ($0)</option>
            </select>
          </div>
          <div class="col-md-2">
            <label class="form-label">Number</label>
            <input type="number" id="waterNumber" class="form-control" min="0">
          </div>
          <div class="col-md-3">
            <label class="form-label">Unit Cost ($)</label>
            <input type="number" id="waterUnitCost" class="form-control" min="0" step="0.01" value="9975" readonly>
          </div>
          <div class="col-md-3">
            <label class="form-label">Subtotal ($)</label>
            <input type="text" id="waterSubtotal" class="form-control" readonly>
          </div>
        </div>
      </div>

      <!-- Sewer -->
      <div class="mb-4">
        <h6 class="fw-bold">Sewer System</h6>
        <div class="row g-2 align-items-end">
          <div class="col-md-4">
            <label class="form-label">Type</label>
            <select id="sewerSystem" class="form-select" onchange="setUnitFromSelect('sewerSystem','sewerUnitCost')">
              <option selected disabled>Choose Wastewater System</option>
              <option value="septic" data-cost="14950">Septic tank (Conventional) ($14,950)</option>
              <option value="aerobic" data-cost="16150">Aerobic OSSF ($16,150)</option>
              <option value="mound" data-cost="20000">Mound System ($20,000)</option>
              <option value="public_res" data-cost="3500">Public Sewer – Residential ($3,500 per LUE)</option>
              <option value="public_com" data-cost="4500">Public Sewer – Commercial ($4,500 per LUE)</option>
              <option value="compost" data-cost="2500">Composting Toilet ($2,500)</option>
            </select>
          </div>
          <div class="col-md-2">
            <label class="form-label">Number</label>
            <input type="number" id="sewerNumber" class="form-control" min="0">
          </div>
          <div class="col-md-3">
            <label class="form-label">Unit Cost ($)</label>
            <input type="number" id="sewerUnitCost" class="form-control" min="0" step="0.01" value="14950" readonly>
          </div>
          <div class="col-md-3">
            <label class="form-label">Subtotal ($)</label>
            <input type="text" id="sewerSubtotal" class="form-control" readonly>
          </div>
        </div>
      </div>

      <!-- Power -->
      <div class="mb-4">
        <h6 class="fw-bold">Power Supply</h6>
        <div class="row g-2 align-items-end">
          <div class="col-md-4">
            <label class="form-label">Type</label>
            <select id="powerSource" class="form-select" onchange="setUnitFromSelect('powerSource','powerUnitCost')">
              <option selected disabled>Choose Power Source</option>
              <option value="grid" data-cost="4900">Grid Connection ($4,900)</option>

              <optgroup label="Off-grid Solar">
                <option value="solar10" data-cost="13440">10 kWh ($13,440)</option>
                <option value="solar13" data-cost="17472">13 kWh ($17,472)</option>
                <option value="solar20" data-cost="26880">20 kWh ($26,880)</option>
                <option value="solar26" data-cost="34944">26 kWh ($34,944)</option>
              </optgroup>

              <optgroup label="Diesel Generator">
                <option value="gensmall" data-cost="14000">Small home (10–14 kW) ($14,000)</option>
                <option value="genmed" data-cost="15500">Medium home (20–24 kW) ($15,500)</option>
                <option value="genlarge" data-cost="18000">Large home (25 kW+) ($18,000)</option>
              </optgroup>

              <optgroup label="Hybrid">
                <option value="hy5" data-cost="16975">Small homes (5 kW) ($16,975)</option>
                <option value="hy10" data-cost="33950">Medium homes (10 kW) ($33,950)</option>
                <option value="hy12" data-cost="40740">Large homes / small business (12 kW) ($40,740)</option>
                <option value="hy15" data-cost="50925">Business (15 kW) ($50,925)</option>
                <option value="hy20" data-cost="67900">Industrial / large commercial (20 kW) ($67,900)</option>
                <option value="hy30" data-cost="101800">Large industries (30 kW) ($101,800)</option>
              </optgroup>

              <option value="meter" data-cost="4900">Electric Meter ($4,900)</option>
            </select>
          </div>
          <div class="col-md-2">
            <label class="form-label">Number</label>
            <input type="number" id="powerNumber" class="form-control" min="0">
          </div>
          <div class="col-md-3">
            <label class="form-label">Unit Cost ($)</label>
            <input type="number" id="powerUnitCost" class="form-control" min="0" step="0.01" value="4900" readonly>
          </div>
          <div class="col-md-3">
            <label class="form-label">Subtotal ($)</label>
            <input type="text" id="powerSubtotal" class="form-control" readonly>
          </div>
        </div>
      </div>

      <!-- Gas -->
      <div class="mb-4">
        <h6 class="fw-bold">Gas Source</h6>
        <div class="row g-2 align-items-end">
          <div class="col-md-4">
            <label class="form-label">Type</label>
            <select id="gasType" class="form-select" onchange="setUnitFromSelect('gasType','gasUnitCost')">
              <option selected disabled>Choose Gas Supply</option>
              <option value="propane_above" data-cost="1650">Propane Tank – Above-ground ($1,650)</option>
              <option value="propane_under" data-cost="3250">Propane Tank – Underground ($3,250)</option>
              <option value="natural" data-cost="1340">Natural Gas Line ($1,340)</option>
              <option value="none" data-cost="0">None ($0)</option>
            </select>
          </div>
          <div class="col-md-2">
              <label class="form-label">Number</label>
              <input type="number" id="gasNumber" class="form-control" min="0">
            </div>
          <div class="col-md-3">
            <label class="form-label">Unit Cost ($)</label>
            <input type="number" id="gasUnitCost" class="form-control" min="0" step="0.01" value="1650" readonly>
          </div>
          <div class="col-md-3">
            <label class="form-label">Subtotal ($)</label>
            <input type="text" id="gasSubtotal" class="form-control" readonly>
          </div>
        </div>
      </div>

      <!-- Phone -->
      <div class="mb-4">
        <h6 class="fw-bold">Phone Service</h6>
        <div class="row g-2 align-items-end">
          <div class="col-md-4">
            <label class="form-label">Type</label>
            <select id="phoneType" class="form-select" onchange="setUnitFromSelect('phoneType','phoneUnitCost')">
              <option selected disabled>Choose Phone Type</option>
              <option value="landline" data-cost="99">Landline ($99)</option>
              <option value="cell" data-cost="35">Cellular ($35)</option>
              <option value="none" data-cost="0">None ($0)</option>
            </select>
          </div>
          <div class="col-md-2">
              <label class="form-label">Number</label>
              <input type="number" id="phoneNumber" class="form-control" min="0">
            </div>
          <div class="col-md-3">
            <label class="form-label">Unit Cost ($)</label>
            <input type="number" id="phoneUnitCost" class="form-control" min="0" step="0.01" value="99" readonly>
          </div>
          <div class="col-md-3">
            <label class="form-label">Subtotal ($)</label>
            <input type="text" id="phoneSubtotal" class="form-control" readonly>
          </div>
        </div>
      </div>

      <!-- Internet -->
      <div class="mb-4">
        <h6 class="fw-bold">Internet Service</h6>
        <div class="row g-2 align-items-end">
          <div class="col-md-4">
            <label class="form-label">Type</label>
            <select id="internetType" class="form-select" onchange="setUnitFromSelect('internetType','internetUnitCost')">
              <option selected disabled>Choose Internet Source</option>
              <option value="fiber" data-cost="150">Fiber Optic ($150)</option>
              <option value="dsl" data-cost="149">DSL / Wired ($149)</option>
              <option value="satellite" data-cost="500">Satellite ($500)</option>
              <option value="cellular" data-cost="35">Mobile Data ($35)</option>
              <option value="none" data-cost="0">None ($0)</option>
            </select>
          </div>
          <div class="col-md-2">
              <label class="form-label">Number</label>
              <input type="number" id="internetNumber" class="form-control" min="0">
            </div>
          <div class="col-md-3">
            <label class="form-label">Unit Cost ($)</label>
            <input type="number" id="internetUnitCost" class="form-control" min="0" step="0.01" value="150" readonly>
          </div>
          <div class="col-md-3">
            <label class="form-label">Subtotal ($)</label>
            <input type="text" id="internetSubtotal" class="form-control" readonly>
          </div>
        </div>
      </div>

      <hr />
          <div class="mb-3">
              <label class="form-label fw-bold">Total Utility Connection Cost</label>
              <input type="text" id="totalUtilityConnectionCost" class="form-control readonly-input fw-bold" readonly />
            </div>

          <button id="totalResult" class="btn btn-dark" style="max-width: 180px; margin: 20px;" onclick="saveAndContinue()">Save</button>
      </div>

      <!-- Total Section (Inside the scrollable area) -->
          <hr />      

            <div class="d-flex justify-content-between gap-2 mb-3">
              <a href="./02sitedevelopmentcost.html" class="btn btn-outline-secondary w-100">⬅️ Previous Step</a>
              <a href="./04buildingprepartioncost.html" class="btn btn-outline-secondary w-100">Next Step ➡️</a>
            </div>

            <div class="d-grid gap-2 mb-5">
              <a href="00b.dashboard.html" class="btn btn-dark">🏠 Back to Cost Dashboard</a>
              <a href="./09finalstep.html" class="btn btn-outline-dark">✅ Review Your Estimate with LHT</a>
            </div>
            </div> <!-- This closes #formScrollableArea -->
      </div>
    </div>

    <script>
      // Load from localStorage and display selected parcel info
      const address = localStorage.getItem("parcelAddress") || "N/A";
      const parcelID = localStorage.getItem("parcelID") || "N/A";
      const lat = localStorage.getItem("latitude") || "N/A";
      const lng = localStorage.getItem("longitude") || "N/A";

      document.getElementById("summaryAddress").textContent = address;
      document.getElementById("summaryParcelID").textContent = parcelID;
      document.getElementById("summaryCoords").textContent = `${lat}, ${lng}`;
    </script>

    <script>
      function setUnitFromSelect(selectId, unitInputId) {
        const sel = document.getElementById(selectId);
        const unit = document.getElementById(unitInputId);
        const cost = sel?.options[sel.selectedIndex]?.getAttribute('data-cost');
        if (cost != null) {
          unit.value = parseFloat(cost);
          computeUtilityCosts();
        }
      }
    </script>


    <script>
      function computeUtilityCosts() {
        const ids = ["water", "sewer", "power", "gas", "phone", "internet"];
        let total = 0;

        ids.forEach((id) => {
          const numberEl   = document.getElementById(`${id}Number`);
          const unitEl     = document.getElementById(`${id}UnitCost`);
          const subtotalEl = document.getElementById(`${id}Subtotal`);

          const number   = parseFloat(numberEl?.value) || 0;
          const unit     = parseFloat(unitEl?.value)   || 0;
          const subtotal = number * unit;

          if (subtotalEl) subtotalEl.value = `$${subtotal.toFixed(2)}`;
          total += subtotal;
        });

        const totalField = document.getElementById("totalUtilityConnectionCost");
        if (totalField) {
          totalField.value = `$${total.toFixed(2)}`;
          localStorage.setItem("utilityConnectionCost", total.toFixed(2));
        }
      }

      function saveAndContinue(e) {
        if (e) e.preventDefault();
        computeUtilityCosts();
        alert("Utility Connection Cost saved!");
        return false;
      }

      // change events for the selects (these update unit cost and recompute)
      document.getElementById('waterSource')   ?.addEventListener('change', () => setUnitFromSelect('waterSource','waterUnitCost'));
      document.getElementById('sewerSystem')   ?.addEventListener('change', () => setUnitFromSelect('sewerSystem','sewerUnitCost'));
      document.getElementById('powerSource')   ?.addEventListener('change', () => setUnitFromSelect('powerSource','powerUnitCost'));
      document.getElementById('gasType')       ?.addEventListener('change', () => setUnitFromSelect('gasType','gasUnitCost'));
      document.getElementById('phoneType')     ?.addEventListener('change', () => setUnitFromSelect('phoneType','phoneUnitCost'));
      document.getElementById('internetType')  ?.addEventListener('change', () => setUnitFromSelect('internetType','internetUnitCost'));

      // number/unit inputs still live-recalculate
      ["water","sewer","power","gas","phone","internet"].forEach((id)=>{
        document.getElementById(`${id}Number`)  ?.addEventListener("input", computeUtilityCosts);
        document.getElementById(`${id}UnitCost`)?.addEventListener("input", computeUtilityCosts);
      });

      window.onload = computeUtilityCosts;
    </script>



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
